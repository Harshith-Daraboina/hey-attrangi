// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  email         String    @unique
  password      String
  name          String?
  role          String    @default("admin")
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Blog {
  id                String    @id @default(auto()) @map("_id") @db.ObjectId
  title             String
  slug              String    @unique
  content           String
  excerpt           String?
  image             String?
  tumblineQuestion  String?   // Main question
  tumblineLine      String?   // Subtitle/tagline
  mainContent       String?   // Main content
  disorderRelation  String?   // Briefly about relation to the disorder
  question          String?   // To the question
  subquestions      String[]  // Array of subquestions
  summary           String?   // Summary
  sourceLink        String?   // Source link of textbook
  published         Boolean   @default(false)
  featured          Boolean   @default(false)
  likes             Int       @default(0)
  views             Int       @default(0)
  author            String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  reviews           Review[]
}

model Review {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  blogId    String   @db.ObjectId
  blog      Blog     @relation(fields: [blogId], references: [id], onDelete: Cascade)
  name      String
  email     String
  comment   String
  rating    Int      @default(5)
  createdAt DateTime @default(now())
}

model Product {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  slug        String   @unique
  description String
  price       Float
  images      String[]
  category    String?
  stock       Int      @default(0)
  published   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Resource {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  slug        String   @unique
  description String
  content     String?
  thumbnail   String?  // Added thumbnail field
  type        String   // "video", "link", "document", "reference", "material"
  url         String?
  fileUrl     String?
  category    String?
  tags        String[]
  published   Boolean  @default(false)
  featured    Boolean  @default(false)
  views       Int      @default(0)
  author      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
model VisualQuestion {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  questionId      String   @unique
  domain          String
  difficulty      String
  ageMin          Int
  ageMax          Int
  weight          Int
  prompt          String
  stimulus        Json
  options         Json?
  answer          Json?
  expectedTimeMs  Int?
  explanation     String?
  createdAt       DateTime @default(now())
}

model TestSession {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String?
  age       Int
  status    String   // active | completed
  startedAt DateTime @default(now())
  endedAt   DateTime?
  currentLog Json?
}

model TestResult {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  sessionId        String
  domainScores     Json
  totalScore       Float
  percentile       Float?
  cognitiveProfile String?
  metadata         Json?
  createdAt        DateTime @default(now())
}

model RawTrialData {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  sessionId    String
  questionId   String
  correct      Boolean
  reactionTime Int
  timestamp    DateTime @default(now())
}
